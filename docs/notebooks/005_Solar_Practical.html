<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Solar radiation and land surface temperature &mdash; Workshop2022 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="1. Crop models" href="../intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Workshop2022
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Practical: Solar Radiation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Incident-PAR">2.2. Incident PAR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Exercise">2.2.1. Exercise</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#The-seasons">2.2.1.1. The seasons</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">2.2.2. Exercise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Weather-generation">2.3. Weather generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">2.3.1. Exercise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Discussion">2.4. Discussion</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Workshop2022</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">2. </span>Solar radiation and land surface temperature</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/005_Solar_Practical.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Solar-radiation-and-land-surface-temperature">
<h1><span class="section-number">2. </span>Solar radiation and land surface temperature<a class="headerlink" href="#Solar-radiation-and-land-surface-temperature" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://mybinder.org/v2/gh/UCL-EO/Workshop2022/HEAD?labpath=notebooks%2F005_Solar_Practical.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<section id="Introduction">
<h2><span class="section-number">2.1. </span>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline"></a></h2>
<p>Two critical driving variables we will need to understand patterns and responses of terrestrial vegetation are the incident shortwave solar radiation and temperature at the land surface. In this practical, we will explore the variations in shortwave solar radiation as a function of latitude and time of year, and associate surface temperature with these.</p>
<p>In a future exercise, we will use such data to drive a model of carbon dynamics by vegetation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">python.solar</span> <span class="kn">import</span> <span class="n">solar_model</span><span class="p">,</span><span class="n">radiation</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage.filters</span>
<span class="kn">from</span> <span class="nn">python.cru</span> <span class="kn">import</span> <span class="n">getCRU</span><span class="p">,</span><span class="n">splurge</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="c1"># import codes we need into the notebook</span>
</pre></div>
</div>
</div>
</section>
<section id="Incident-PAR">
<h2><span class="section-number">2.2. </span>Incident PAR<a class="headerlink" href="#Incident-PAR" title="Permalink to this headline"></a></h2>
<p>Solar radiation drives the Earth system and strongly impacts the terrestrial Carbon cylcle.</p>
<p>We will use a model of solar radiation to examine diurnal and seasonal variations. We use the <a class="reference external" href="http://rhodesmill.org/pyephem/">PyEphem</a> Python package, which allows us to calculate the position of the sun with respect to an observer on Earth. So we need time as well as longitude and latitude.</p>
<p>Before we do that, let’s make sure we understand the main factors causing these variations.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">solar_model</span></code> method that gives time axis in units of Julian days, as well as the solar zenith angle (in degrees), the Earth-Sun distance, as well as the solar radiation in mol(photons)/m^2s.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">solar_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function solar_model in module python.solar:

solar_model(secs, mins, hours, days, months, years, lats, longs, julian_offset=&#39;2000/1/1&#39;)
    A function that calculates the solar zenith angle (sza, in
    degrees), the Earth-Sun distance (in AU), and the instantaneous
    downwelling solar radiation in mol(photons) per square meter per
    second for a set of time(s) and geographical locations.

</pre></div></div>
</div>
<p>A small aside on defining dates. We will be defining the date by the day of year (<code class="docutils literal notranslate"><span class="pre">doy</span></code>) when we run these exercises, but the code we are using requires a definition of date as days and month. To convert between these in Python, we use the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> module to specify the 1st of January for the given year in the variable <code class="docutils literal notranslate"><span class="pre">datetime_object</span></code>, then add on the <code class="docutils literal notranslate"><span class="pre">doy</span></code> (actually <code class="docutils literal notranslate"><span class="pre">doy-1</span></code> because when <code class="docutils literal notranslate"><span class="pre">doy</span></code> is 1 we mean January 1st). We then specify <code class="docutils literal notranslate"><span class="pre">day</span></code> <code class="docutils literal notranslate"><span class="pre">month</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code> as
<code class="docutils literal notranslate"><span class="pre">datetime_object.day</span></code>,<code class="docutils literal notranslate"><span class="pre">datetime_object.month</span></code>,<code class="docutils literal notranslate"><span class="pre">datetime_object.year</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set a date by year and doy</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2020</span>
<span class="n">doy</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1"># convert to datetime object</span>
<span class="n">datetime_object</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">doy</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># extract day, month and year</span>
<span class="n">datetime_object</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">datetime_object</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">datetime_object</span><span class="o">.</span><span class="n">year</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1, 2, 2020)
</pre></div></div>
</div>
<p>Orbital mechanics impose a variation in the Earth-Sun distance over the year. This is typically expressed in <a class="reference external" href="https://en.wikipedia.org/wiki/Astronomical_unit">Astronomical Units</a> (AU), so relative to the mean Earth-Sun distance.</p>
<p>The Exo-atmospheric solar radiation E0 (<span class="math notranslate nohighlight">\(W/m^2\)</span>) (total shortwave radiation) is defined as:</p>
<div class="math notranslate nohighlight">
\[E0 = \frac{G_{sc}}{r^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(G_{sc}\)</span> is the Solar Constant (around 1361 <span class="math notranslate nohighlight">\(W/m^2\)</span>) and <span class="math notranslate nohighlight">\(r\)</span> is the Earth-Sun distance in AU (inverse-squared law).</p>
<p>Around half of the SW energy is in the PAR region, so to calculate PAR, we scale by 0.5.</p>
<p>The energy content of PAR quanta is around <span class="math notranslate nohighlight">\(220.e-3\)</span> <span class="math notranslate nohighlight">\(MJmol^{-1}\)</span>, so the top of atmosphere (TOA) PAR solar radiation is <span class="math notranslate nohighlight">\(\frac{E0}{2 \times 220.e-3}\)</span> <span class="math notranslate nohighlight">\(mol/{m^2s}\)</span>, so 3093 = <span class="math notranslate nohighlight">\(mol/{m^2s}\)</span> at 1 AU.</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">solar_model</span></code> to calculate this distance and ipar variation, and visualise the orbit:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span><span class="o">=</span><span class="mi">2020</span>
<span class="n">doys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">366</span><span class="p">)</span>
<span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">doy</span> <span class="ow">in</span> <span class="n">doys</span><span class="p">]</span>
<span class="c1"># solar distance in AU</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">solar_model</span><span class="p">(</span><span class="mf">0.</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">12</span><span class="p">],</span>\
            <span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">swrad</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">solar_model</span><span class="p">(</span><span class="mf">0.</span><span class="p">,[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">12</span><span class="p">],</span>\
            <span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;distance range : </span><span class="si">{</span><span class="n">distance</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s1">6.4f</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">distance</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s1">6.4f</span><span class="si">}</span><span class="s1"> AU&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;swrad    range : </span><span class="si">{</span><span class="n">swrad</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s1">6.0f</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">swrad</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s1">6.0f</span><span class="si">}</span><span class="s1"> mol/ (m^2 s)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

distance range : 0.9832 to 1.0167 AU
swrad    range :   5985 to   6400 mol/ (m^2 s)
</pre></div></div>
</div>
<img alt="Seasons" src="https://upload.wikimedia.org/wikipedia/commons/f/f0/Seasons1.svg" /><img alt="Earth-Sun distance" src="../_images/earth.gif" />
<p>This <a class="reference external" href="python/sunplot.py">animation</a> shows the variation in Earth-Sun distance. The eccentricity of the Earth orbit is <strong>really quite low</strong> (0.0167) (a circle at 1 AU is shown as a dashed line) so the solar radiation varies by around 7% over the year. The ipar variation is illustrated by the size of the Sun in this animation, the diameter of which is made proportional to ipar but exxagerated to the 4th power for illustration.</p>
<section id="Exercise">
<h3><span class="section-number">2.2.1. </span>Exercise<a class="headerlink" href="#Exercise" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>At what time of year is PAR radiation incident on Earth the highest?</p></li>
<li><p>Why is this so?</p></li>
</ul>
<section id="The-seasons">
<h4><span class="section-number">2.2.1.1. </span>The seasons<a class="headerlink" href="#The-seasons" title="Permalink to this headline"></a></h4>
<p>We need to take account of this annual (7%) variation when we model PAR interception by vegetation, but it is not the strongest cause of variation over the year. Solar radiation is projected onto the Earth surface. We can express this projection by the cosine of the solar zenith angle. When the Sun is directly overhead (zenith angle zero degrees), then the projection is 1. As the zenith angle increases, the projected radiation decreases until it is 0 at a zenith angle of 90 degrees.</p>
<p>The seasons are not directly related to the Earth-Sun distance variations then. They arise in the main because the Earth is tilted on its axis by 23.5 degrees (obliquity).</p>
<img alt="https://www.nasa.gov/sites/default/files/thumbnails/image/axis_.png" src="https://www.nasa.gov/sites/default/files/thumbnails/image/axis_.png" />
<p>We will use <code class="docutils literal notranslate"><span class="pre">solar_model</span></code> to calculate the amount of incoming PAR. To do this, we assume:</p>
<ul class="simple">
<li><p>that PAR is around 50% of total downwelling (shortwave) radiation,</p></li>
<li><p>that the optical thickness (<span class="math notranslate nohighlight">\(\tau\)</span>) of the atmosphere in the PAR region is around 0.2</p></li>
<li><p>and that we multiply by all this by <span class="math notranslate nohighlight">\(\cos(sza)\)</span> to project on to a flat surface.</p></li>
</ul>
<p>Let’s look at how that varies over the year, for some different latitudes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span><span class="o">=</span><span class="mi">2022</span>
<span class="c1"># plot solstices and equinox</span>
<span class="n">es</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">21</span><span class="p">)]</span>
<span class="n">des</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">es</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>

<span class="n">doys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">366</span><span class="p">)</span>
<span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">doy</span> <span class="ow">in</span> <span class="n">doys</span><span class="p">]</span>


<span class="n">tau</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">parprop</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">latitudes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="o">-</span><span class="mf">23.5</span><span class="p">,</span><span class="mf">23.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">23.5</span><span class="p">,</span><span class="mf">23.5</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># equinox and solstice as dashed lines</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">des</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,[</span><span class="mi">1000</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">des</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,[</span><span class="mi">3100</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">lat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">latitudes</span><span class="p">):</span>
    <span class="n">swrad</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">solar_model</span><span class="p">(</span><span class="mf">0.</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="mi">0</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">])</span>
    <span class="n">sza</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">solar_model</span><span class="p">(</span><span class="mf">0.</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dts</span><span class="p">])</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">))</span>
    <span class="n">ipar</span> <span class="o">=</span> <span class="p">(</span><span class="n">swrad</span><span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">parprop</span><span class="p">)</span>
    <span class="n">ipar</span><span class="p">[</span><span class="n">ipar</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">doys</span><span class="p">,</span><span class="n">ipar</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;lat </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">doys</span><span class="p">,</span><span class="n">ipar</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;lat </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mean iPAR over day&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;day of year&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ipar ($PAR_</span><span class="si">{inc}</span><span class="s1">\,\sim$ $mol\, photons/ (m^2 s)$)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">doys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Noon iPAR over day&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;day of year&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ipar ($PAR_</span><span class="si">{inc}</span><span class="s1">\,\sim$ $mol\, photons/ (m^2 s)$)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">doys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[79, 171, 263, 354]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.0, 365.0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_19_2.png" src="../_images/notebooks_005_Solar_Practical_19_2.png" />
</div>
</div>
<p>Now, lets look at variation over the day, for some selected days:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">parprop</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">year</span><span class="o">=</span><span class="mi">2020</span>

<span class="c1"># equinox and solstice</span>
<span class="n">es</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">21</span><span class="p">)]</span>
<span class="n">des</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">days</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">es</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">des</span><span class="p">)</span>

<span class="n">latitudes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="o">-</span><span class="mf">23.5</span><span class="p">,</span><span class="mf">23.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">23.5</span><span class="p">,</span><span class="mf">23.5</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latitudes</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">3.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">latitudes</span><span class="p">)))</span>

<span class="n">legends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;March Equinox&#39;</span><span class="p">,</span><span class="s1">&#39;June Solstice&#39;</span><span class="p">,</span><span class="s1">&#39;September Equinox&#39;</span><span class="p">,</span><span class="s1">&#39;December Solstice&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">lat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">latitudes</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;latitude: </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ipar &#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2700</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">doy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">des</span><span class="p">):</span>
        <span class="c1"># datetime</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">doy</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># call solar_model</span>
        <span class="n">jd</span><span class="p">,</span> <span class="n">sza</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">solar_radiation</span> <span class="o">=</span> <span class="n">solar_model</span><span class="p">(</span>
                <span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mi">30</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">solar_radiation</span><span class="o">*</span><span class="n">parprop</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">jd</span><span class="o">-</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">24</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">legends</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;latitude: </span><span class="si">{</span><span class="n">latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> iPAR ($mol\, photons/ (m^2 s)$)&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;day hour&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[80, 172, 264, 355]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_21_1.png" src="../_images/notebooks_005_Solar_Practical_21_1.png" />
</div>
</div>
</section>
</section>
<section id="id1">
<h3><span class="section-number">2.2.2. </span>Exercise<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Describe and explain the patterns of iPAR as a function of day of year and latitude.</p></li>
<li><p>Comment on the likely reality of these patterns.</p></li>
</ul>
</section>
</section>
<section id="Weather-generation">
<h2><span class="section-number">2.3. </span>Weather generation<a class="headerlink" href="#Weather-generation" title="Permalink to this headline"></a></h2>
<p>To run our photosynthesis model, we need to know the temperature as well as the IPAR. That is rather complicated to model, so we will use observational data to drive the model. We choose the interpolated <a class="reference external" href="https://sites.uea.ac.uk/cru/data">CRU climate dataset</a> for this.</p>
<p>You can select this using the <code class="docutils literal notranslate"><span class="pre">`getCRU()</span></code> &lt;python/cru.py&gt;`__ function for a given latitude, longitude and year (2011 to 2019 inclusive here). This gives you access to <strong>monthly</strong> minimum and maximum temperatures, <code class="docutils literal notranslate"><span class="pre">f['tmn']</span></code> and <code class="docutils literal notranslate"><span class="pre">f['tmx']</span></code> respectively, as well as cloud cover percentage <code class="docutils literal notranslate"><span class="pre">f['cld']</span></code>. The dataset is for the land surface only. If you specify somewhere in the ocean, you will get an interpolated result.</p>
<p>We will use the cloud percentage to reduce iPAR, by setting a reduction factor by 1/3 (to a value of 2/3) on cloudy days (when <code class="docutils literal notranslate"><span class="pre">f['cld']</span></code> is 100) and 1 when there is no cloud.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scale = 1 - f[&#39;cld&#39;]/300
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">python.cru</span> <span class="kn">import</span> <span class="n">getCRU</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">getCRU</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">latitude</span><span class="o">=</span><span class="mi">56</span><span class="p">)</span>
<span class="n">tmx</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tmx&#39;</span><span class="p">]</span>
<span class="n">tmn</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tmn&#39;</span><span class="p">]</span>
<span class="n">cld</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;cld&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmx</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;tmx / C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmn</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;tmn / C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cld</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;cld (percent)&#39;</span><span class="p">)</span>
<span class="c1"># irradiance reduced by 1/3  on cloudy days</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cld</span><span class="o">/</span><span class="mf">300.</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;100*scale&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;month index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_25_0.png" src="../_images/notebooks_005_Solar_Practical_25_0.png" />
</div>
</div>
<p>Since we only have monthly minimum and maximum temperature, we need to be able to estimate the diurnal variation of temperature from these. We can broadly achieve this by scaling by normalised IPAR. However, there will be a time lag between greater radiation input and temperature caused by inertia in the system. We can mimic this effect with a one-sided smoothing filter that ‘smears’ the temperature forward in time. The degree of smearing is controlled by the filter width parameter <code class="docutils literal notranslate"><span class="pre">f</span></code> (e.g. 8
hours). This is achieved in the function <code class="docutils literal notranslate"><span class="pre">splurge</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">splurge</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Spread the quantity ipar forward in time</span>
<span class="sd">    using a 1-sided exponential filter of width</span>
<span class="sd">    f * 2.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        ipar: array of 1/2 hourly time step ipar values</span>
<span class="sd">              (length 48)</span>

<span class="sd">    Keyword:</span>
<span class="sd">        f : filter characteristic width. Filter is</span>
<span class="sd">            exp(-x/(f*2))</span>

<span class="sd">    Return:</span>
<span class="sd">        ipar_ : normalised, splurged ipar array</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ipar</span><span class="o">-</span><span class="n">ipar</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">ipar</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">ipar</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="c1"># build filter over large extent</span>
    <span class="n">nrf_x_large</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># filter function f * 2 as f is in hours</span>
    <span class="c1"># but data in 1/2 hour steps</span>
    <span class="n">nrf_large</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">nrf_x_large</span><span class="o">/</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1"># 1-sided filter</span>
    <span class="n">nrf_large</span><span class="p">[</span><span class="n">nrf_x_large</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nrf_large</span> <span class="o">/=</span> <span class="n">nrf_large</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">ipar_</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">convolve1d</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span> <span class="n">nrf_large</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wrap&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nrf_x_large</span><span class="p">,</span><span class="n">nrf_large</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ipar_</span><span class="o">-</span><span class="n">ipar_</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">ipar_</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">ipar_</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate solar position over a day, every 30 mins</span>
<span class="n">year</span><span class="o">=</span><span class="mi">2020</span>
<span class="n">doy</span> <span class="o">=</span><span class="mi">80</span>
<span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="mi">51</span><span class="p">,</span><span class="mi">0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">doy</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># solar radiation</span>
<span class="n">jd</span><span class="p">,</span> <span class="n">sza</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">solar_radiation</span> <span class="o">=</span> <span class="n">solar_model</span><span class="p">(</span>
    <span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">30.</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
    <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>

<span class="n">hour</span> <span class="o">=</span> <span class="p">(</span><span class="n">jd</span><span class="o">-</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">24</span>
<span class="c1"># cosine</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">))</span>
<span class="n">ipar</span> <span class="o">=</span> <span class="n">solar_radiation</span><span class="o">*</span> <span class="n">parprop</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span>

<span class="c1"># show filter</span>
<span class="n">_</span><span class="o">=</span><span class="n">splurge</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_28_0.png" src="../_images/notebooks_005_Solar_Practical_28_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># smear ipar</span>
<span class="c1"># filter length f (hours)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># hours</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">ipar_</span> <span class="o">=</span> <span class="n">splurge</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span><span class="n">ipar_</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;f=</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">, peak time shifted from </span><span class="si">{</span><span class="n">hour</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ipar</span><span class="p">)]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> hrs to </span><span class="si">{</span><span class="n">hour</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ipar_</span><span class="p">)]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> hrs&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
f=0, peak time shifted from 12.0 hrs to 12.0 hrs
f=1, peak time shifted from 12.0 hrs to 13.0 hrs
f=2, peak time shifted from 12.0 hrs to 13.5 hrs
f=3, peak time shifted from 12.0 hrs to 14.0 hrs
f=4, peak time shifted from 12.0 hrs to 14.5 hrs
f=5, peak time shifted from 12.0 hrs to 15.0 hrs
f=6, peak time shifted from 12.0 hrs to 15.0 hrs
f=7, peak time shifted from 12.0 hrs to 15.0 hrs
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_29_1.png" src="../_images/notebooks_005_Solar_Practical_29_1.png" />
</div>
</div>
<p>A value of <code class="docutils literal notranslate"><span class="pre">f</span></code> of <code class="docutils literal notranslate"><span class="pre">8</span></code> give a 2 hour delay in the peak of around 2 hours which is a reasonable average value we can use to mimic temperature variations. A simple model of diurnal temperature variatioins then is to simply scale this by the monthly temperature minimum and maximum values:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Tc = ipar_*(Tmax-Tmin)+Tmin
</pre></div>
</div>
<p>One problem with this approach is that the variation we achieve in temperature (and IPAR) is significantly less than in reality. This can reduce the apparent variation in CO2 fluxes. In practice, when modellers attempt to estimate instantaneous (or short time-integral) values from means, they insert additional random variation to match some other sets of observed statistical variation (including correlations). We ignore that here, for simplicity.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="k">def</span> <span class="nf">radiation</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="n">longitude</span><span class="p">,</span><span class="n">doy</span><span class="p">,</span>
              <span class="n">tau</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">parprop</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span>
              <span class="n">Tmin</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span><span class="n">Tmax</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mf">8.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Simple model of solar radiation making call</span>
<span class="sd">    to solar_model(), calculating modelled</span>
<span class="sd">    ipar</span>

<span class="sd">    Arguments:</span>
<span class="sd">    latitude : latitude (degrees)</span>
<span class="sd">    longitude: longitude (degrees)</span>
<span class="sd">    doy:  day of year (integer)</span>

<span class="sd">    Keywords:</span>

<span class="sd">    tau:     optical thickness (0.2 default)</span>
<span class="sd">    parprop: proportion of solar radiation in PAR</span>
<span class="sd">    Tmin:    min temperature (C) 20.0 default</span>
<span class="sd">    Tmax:    max temperature (C) 30.0 default</span>
<span class="sd">    year:    int 2020 default</span>
<span class="sd">    f:       Temperature smearing function characteristic</span>
<span class="sd">             length (hours)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Calculate solar position over a day, every 30 mins</span>
    <span class="c1"># for somewhere like London (latitude 51N, Longitude=0)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">doy</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">jd</span><span class="p">,</span> <span class="n">sza</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">solar_radiation</span> <span class="o">=</span> <span class="n">solar_model</span><span class="p">(</span>
        <span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">30.</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">),</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
        <span class="n">latitude</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">julian_offset</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">/1/1&#39;</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">sza</span><span class="p">))</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ipar</span> <span class="o">=</span> <span class="n">solar_radiation</span><span class="o">*</span> <span class="n">parprop</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tau</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span>  <span class="c1"># u mol(photons) / (m^2 s)</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">getCRU</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span><span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">)</span>
    <span class="n">Tmax</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;tmx&#39;</span><span class="p">][</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Tmin</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;tmn&#39;</span><span class="p">][</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cld</span> <span class="o">=</span> <span class="n">fd</span><span class="p">[</span><span class="s1">&#39;cld&#39;</span><span class="p">][</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">cld</span><span class="o">/</span><span class="mf">300.</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tmin </span><span class="si">{</span><span class="n">Tmin</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> Tmax </span><span class="si">{</span><span class="n">Tmax</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> Cloud </span><span class="si">{</span><span class="n">cld</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> Scale </span><span class="si">{</span><span class="n">scale</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># reduce irradiance by 1/3 on cloudy day</span>
    <span class="n">ipar</span> <span class="o">=</span> <span class="n">ipar</span> <span class="o">*</span> <span class="n">scale</span>
    <span class="c1"># smear ipar</span>
    <span class="n">ipar_</span> <span class="o">=</span> <span class="n">splurge</span><span class="p">(</span><span class="n">ipar</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># normalise</span>
    <span class="n">Tc</span> <span class="o">=</span> <span class="n">ipar_</span><span class="o">*</span><span class="p">(</span><span class="n">Tmax</span><span class="o">-</span><span class="n">Tmin</span><span class="p">)</span><span class="o">+</span><span class="n">Tmin</span>
    <span class="c1">#Tc = (Tc-Tc.min())</span>
    <span class="c1">#Tc = Tc/Tc.max()</span>
    <span class="c1">#Tc = (Tc*(Tmax-Tmin) + (Tmin))</span>
    <span class="k">return</span> <span class="n">jd</span><span class="o">-</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ipar</span><span class="p">,</span><span class="n">Tc</span>
<br/></pre></div>
</div>
</div>
<p>We can now run the driver synthesis for some given latitude/longitude and time period:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tau</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">parprop</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">year</span><span class="o">=</span><span class="mi">2020</span>

<span class="n">latitude</span> <span class="o">=</span> <span class="mi">51</span>
<span class="n">longitude</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="c1"># loop over solstice and equinox doys</span>
<span class="k">for</span> <span class="n">doy</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span><span class="mi">172</span><span class="p">,</span><span class="mi">264</span><span class="p">,</span><span class="mi">355</span><span class="p">]:</span>
    <span class="n">jd</span><span class="p">,</span><span class="n">ipar</span><span class="p">,</span><span class="n">Tc</span> <span class="o">=</span> <span class="n">radiation</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="n">longitude</span><span class="p">,</span><span class="n">doy</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jd</span><span class="o">-</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ipar</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ipar doy </span><span class="si">{</span><span class="n">doy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jd</span><span class="o">-</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Tc</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Tc doy </span><span class="si">{</span><span class="n">doy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># plotting refinements</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ipar ($PAR_</span><span class="si">{inc}</span><span class="s1">\,\sim$ $\mu mol\, photons/ (m^2 s))$)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tc (C)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Fraction of day&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;latitude </span><span class="si">{</span><span class="n">latitude</span><span class="si">}</span><span class="s2"> longitude </span><span class="si">{</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Tmin 5.50 Tmax 11.60 Cloud 71.30 Scale 0.76
Tmin 12.20 Tmax 19.90 Cloud 64.20 Scale 0.79
Tmin 11.90 Tmax 19.20 Cloud 63.10 Scale 0.79
Tmin 5.20 Tmax 10.00 Cloud 81.60 Scale 0.73
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_005_Solar_Practical_33_1.png" src="../_images/notebooks_005_Solar_Practical_33_1.png" />
</div>
</div>
<section id="id2">
<h3><span class="section-number">2.3.1. </span>Exercise<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">radiation()</span></code> function to explore ipar and temperature for different locations and times of year</p></li>
<li><p>How are these patterns likely to affect what plants grow where?</p></li>
</ul>
</section>
</section>
<section id="Discussion">
<h2><span class="section-number">2.4. </span>Discussion<a class="headerlink" href="#Discussion" title="Permalink to this headline"></a></h2>
<p>In this practical, you should have developed an improved understanding of solar radiation and temperature. These are critical drivers for plants, and this sort of understanding is key to appreciating the overall patterns of vegetation growth and to developing models of terrestrial Carbon dynamics. Of course, there are many other factors that impinge on actual Carbon dynamics, not the least of which is modification of the environment by man.</p>
<p>In the following lectures and practicals, we will integrate these drivers with process models.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../intro.html" class="btn btn-neutral float-left" title="1. Crop models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Professor P. Lewis.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>